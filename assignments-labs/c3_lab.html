<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-09-03">

<title>Class 3 Lab: Working with US Census Decennial 2020 Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="c3_lab_files/libs/clipboard/clipboard.min.js"></script>
<script src="c3_lab_files/libs/quarto-html/quarto.js"></script>
<script src="c3_lab_files/libs/quarto-html/popper.min.js"></script>
<script src="c3_lab_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="c3_lab_files/libs/quarto-html/anchor.min.js"></script>
<link href="c3_lab_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="c3_lab_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="c3_lab_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="c3_lab_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="c3_lab_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="c3_lab_files/styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#preamble" id="toc-preamble" class="nav-link active" data-scroll-target="#preamble">Preamble</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#step-1-project-management-in-rstudio-for-lab_3-also-applicable-for-assignment_3" id="toc-step-1-project-management-in-rstudio-for-lab_3-also-applicable-for-assignment_3" class="nav-link" data-scroll-target="#step-1-project-management-in-rstudio-for-lab_3-also-applicable-for-assignment_3">Step 1: Project Management in RStudio for <code>lab_3</code> (also applicable for <code>assignment_3</code>)</a></li>
  <li><a href="#extra-section---housing-data-time-permitting" id="toc-extra-section---housing-data-time-permitting" class="nav-link" data-scroll-target="#extra-section---housing-data-time-permitting">Extra Section - Housing Data (time permitting)</a></li>
  <li><a href="#concluding-remarks" id="toc-concluding-remarks" class="nav-link" data-scroll-target="#concluding-remarks">Concluding Remarks</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References:</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Class 3 Lab: Working with US Census Decennial 2020 Data</h1>
<p class="subtitle lead">Fall 2025 | Instructor: Stephen Metts | <a href="https://courses.newschool.edu/courses/PGUD5160/">PGUD 5160 - CRN 2247</a></p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 3, 2025</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="preamble" class="level2">
<h2 class="anchored" data-anchor-id="preamble">Preamble</h2>
<p>In this third demonstration lab, we will repeat the project setup phase of the 2nd week (setting the working directory to <code>lab_3</code>) then move along to accessing US Census data, followed by visualizing census data for both NY State and NYC. This lab can and should be used in conjunction with this week’s assignment 3 deliverable - <a href="https://tns-course-repositories.github.io/Methods_1-PGUD5160-DUE-Program-fall25/assignments-labs/c3_assignment">Assignment 3</a>.</p>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c3_lab_files/img/3_api.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>Location of US Census available APIs</em></figcaption><p></p>
</figure>
</div>
<p>At the <a href="https://www.census.gov/data/developers/data-sets.html">census developer’s endpoint overview</a>, note that there is a <code>Request a KEY</code> button at the left side of the webpage; also available directly <a href="https://api.census.gov/data/key_signup.html">HERE</a>. This will bring you to a entry form in which you will state your email address and for the organization you can simply state your own name. Make sure to click the terms box and ensure you have access to this email address immediately, as the US Census will deliver your key via the entered email address.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c3_lab_files/img/3_api-key.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>Request your API Key</em></figcaption><p></p>
</figure>
</div>
<p>Quickly navigate to your email address and find the email from the US Census; note the key seen in the following image (magenta box):</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c3_lab_files/img/3_api-key-email.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>API key email delivery</em></figcaption><p></p>
</figure>
</div>
<p>Here is a quick definition of an API key:</p>
<blockquote class="blockquote">
<p>An API key, or Application Programming Interface Key, is a unique alphanumeric code used to identify and authenticate a user or application when making requests to an API. It functions as a credential, similar to a username and password, but specifically for programmatic access to a service.</p>
</blockquote>
<p>Make sure to copy your API key for safekeeping. You can always generate a new key; and we will also install the key so that all R sessions will have access to it until you change it at some point in the future.</p>
</section>
<section id="step-1-project-management-in-rstudio-for-lab_3-also-applicable-for-assignment_3" class="level2">
<h2 class="anchored" data-anchor-id="step-1-project-management-in-rstudio-for-lab_3-also-applicable-for-assignment_3">Step 1: Project Management in RStudio for <code>lab_3</code> (also applicable for <code>assignment_3</code>)</h2>
<p>With the census API key secured, we will set up a <code>lab_3</code> project directory just as we did for <code>lab_2</code>. In fact, you can simply <code>copy/paste</code> the <code>lab_2</code> directory, delete all the files therein and set the now <code>lab_3</code> project directory via <em>Existing Directory</em>. We will assume the location will be <code>~/Desktop/lab_3/</code>; and the structure will be as follows:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c3_lab_files/img/3-project-set.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>RStudio &gt; File &gt; New Project &gt; Existing Directory</em></figcaption><p></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c3_lab_files/img/3-project.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>Lab 3 Directory + Subdirectory Structure</em></figcaption><p></p>
</figure>
</div>
<p>A well-organized folder structure within an RStudio project is crucial. Common conventions include:</p>
<p><code>data/</code>: For raw data (treated as read-only).</p>
<p><code>docs/</code>: For documentation or R Markdown files.</p>
<p><code>results/</code>: For outputs and generated results.</p>
<p><code>scripts/</code>: For R scripts and analysis pipelines.</p>
<p><code>docs/</code>: For documentation or R Markdown files.</p>
<section id="step-2" class="level4">
<h4 class="anchored" data-anchor-id="step-2">Step 2:</h4>
<p>With the <code>lab_3.Rproj</code> established and the subdirectories for our data analysis established, we can move along to working on the code steps for US Census Decennial 2020 data.</p>
<ul>
<li>Download the <a href="https://github.com/tns-course-repositories/Methods_1-PGUD5160-DUE-Program-fall25/blob/main/scripts/c3_lab3-script.R">Class 3 Lab 3 R Script</a>; open this script into your current working environment. You can also save this easily in your newly created <code>scripts/</code> subdirectory.</li>
</ul>
<p>To start, it makes sense to check that indeed our project is located correctly in the directory we’ve established:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1"><a href="#cb1-1"></a>get(wd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1"><a href="#cb2-1"></a>list.files("~/Desktop/lab_3", recursive = TRUE, include.dirs = TRUE, full.names = TRUE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This should return the expected <code>lab_3</code> project directory.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c3_lab_files/img/3-wd.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>Checking the working directory</em></figcaption><p></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c3_lab_files/img/3_list.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>Listing the directory</em></figcaption><p></p>
</figure>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Your ‘upstream’ path will likely be different than <code>Users/x15</code>… if you are using macOS, your full path would be akin to <code>/Users/your_machine_name/Desktop/lab_3</code>. This is fine; we want to simply make sure that the directory we created - <code>lab_3</code> is indeed the directory in which and from which we are and will be working.</p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This lab, like the course generally, utilizes macOS file path conventions. Windows users need to adjust for this difference between their OS conventions and macOS. Windows utilizes the opposite ‘backward’ slash convention as well as naming explicitly the drive location: Windows: <code>C:\Users\username\Desktop\lab_3</code> Linux/macOS: <code>/Users/username/Desktop/lab_3</code></p>
</div>
</div>
</section>
<section id="step-3" class="level4">
<h4 class="anchored" data-anchor-id="step-3">Step 3:</h4>
<p>Unlike labs and assignments thus far, this week we will begin to augment <code>base R</code> with packages:</p>
<blockquote class="blockquote">
<p>In R, packages are fundamental units for organizing, sharing, and reusing R code, data, and documentation. They are essentially collections of functions, data sets, and compiled code conveniently bundled together to extend the capabilities of base R.</p>
</blockquote>
<p>Argubably, the most important package in R is known as <code>tidyverse</code>:</p>
<blockquote class="blockquote">
<p>The tidyverse is an opinionated collection of R packages designed for data science. It is not a single package but rather a suite of packages that work together harmoniously, sharing common data representations, syntax, and a consistent philosophy for data analysis.</p>
</blockquote>
<p>For US Census work, a closely aligned subsequent package is aptly called <code>tidycensus</code>:</p>
<blockquote class="blockquote">
<p>tidycensus is an R package that allows users to interface with a select number of the US Census Bureau’s data APIs and return tidyverse-ready data frames.</p>
</blockquote>
<p>A tidyverse-ready data frame is referred to as a <code>tibble</code>:</p>
<blockquote class="blockquote">
<p>A tibble in R is a modern, reimagined version of the traditional data.frame object, designed to be more consistent and user-friendly, particularly within the tidyverse ecosystem. While functionally similar to data frames in representing tabular data (rows as observations, columns as variables), tibbles introduce several key behavioral differences and enhancements.</p>
</blockquote>
<p>to get started, we first install packages. For this week’s lab, we will need <code>tidycensus</code>, <code>tidyverse</code> and a package for extending aesthetics called <code>ggthemes</code>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Navigate to <em>File&gt;Open File</em> and point to the <code>c3_labs3-script.R</code> that you should have already downloaded and placed into the <code>scripts</code> subdirectory. The <code>c3_labs3-script.R</code> has all the necessary code declared in the lab to follow.</p>
</div>
</div>
<p>There are two ways to install packages. First, one-by-one; alternatively all determined by a character vector:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb3-1"><a href="#cb3-1"></a>install.packages("package_name")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>or</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb4-1"><a href="#cb4-1"></a>install.packages(c("package1", "package2", "package3"))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We will choose the first option so that we can watch what each package downloads before moving along to the next:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb5-1"><a href="#cb5-1"></a>install.packages("tidycensus")</span>
<span id="cb5-2"><a href="#cb5-2"></a>install.packages("tidyverse")</span>
<span id="cb5-3"><a href="#cb5-3"></a>install.packages("ggthemes")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-4" class="level4">
<h4 class="anchored" data-anchor-id="step-4">Step 4:</h4>
<p>Next, we call the three libraries into the working session:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb6-1"><a href="#cb6-1"></a>library(tidycensus)</span>
<span id="cb6-2"><a href="#cb6-2"></a>library(tidyverse)</span>
<span id="cb6-3"><a href="#cb6-3"></a>library(ggthemes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-4-1" class="level4">
<h4 class="anchored" data-anchor-id="step-4-1">Step 4:</h4>
<p>Towards the top of the <code>lab_3</code> script, you will find the following code chunk for installing your census API key:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb7-1"><a href="#cb7-1"></a>census_api_key("YOUR API KEY GOES HERE")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To start, replace <code>"YOUR API KEY GOES HERE"</code> with your actual code delivered to your email. Next, let’s adapt the key so that its installed into the R environment in a more permanent manner so that you don’t have to repeatedly declare your key every time you make a census data call. To do this adapt the code chunk as follows:</p>
<p>census_api_key(“YOUR KEY”, install = TRUE))</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb8-1"><a href="#cb8-1"></a>census_api_key("YOUR KEY GOES HERE", install = TRUE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Check the Console and find the following command, which you can run to initiate the key and begin working:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c3_lab_files/img/3_environment.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>API key storage established</em></figcaption><p></p>
</figure>
</div>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb9-1"><a href="#cb9-1"></a>readRenviron("~/.Renviron")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-5" class="level4">
<h4 class="anchored" data-anchor-id="step-5">Step 5:</h4>
<p>With our project directory set up for <code>lab_3</code> and necessary packages and our API key installed, we can now make the first US Census call via the <code>tidycensus</code> package. Like all packages, specific functions and syntax are utilized to determine specific parameters. To start with <code>tidycensus</code> we want to know what variables are available and what exactly are the themes these variables represent. We can do that first in the <code>pl</code> file and then in the <code>dhc</code> file of the decennial census 2020:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb10-1"><a href="#cb10-1"></a>pl_variables &lt;- load_variables(2020, "pl")</span>
<span id="cb10-2"><a href="#cb10-2"></a>dhc_variables &lt;- load_variables(2020, "dhc")</span>
<span id="cb10-3"><a href="#cb10-3"></a>view(pl_variables)</span>
<span id="cb10-4"><a href="#cb10-4"></a>view(dhc_variables)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c3_lab_files/img/3_race.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>R table view of the pl variables</em></figcaption><p></p>
</figure>
</div>
<p>We will structure the first call with <code>tidycensus</code> with the following parameters:</p>
<ul>
<li>geography = state level</li>
<li>variables = Total population (P1_001N)</li>
<li>year = 2020</li>
<li>specific file = pl</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb11-1"><a href="#cb11-1"></a>pop_data &lt;- get_decennial(geography = "state",</span>
<span id="cb11-2"><a href="#cb11-2"></a>                          variables = "P1_001N",</span>
<span id="cb11-3"><a href="#cb11-3"></a>                          year = 2020,</span>
<span id="cb11-4"><a href="#cb11-4"></a>                          sumfile = "pl"</span>
<span id="cb11-5"><a href="#cb11-5"></a>                          )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>census calls via <code>tidycensus</code> can fail - particularly on wifi vs more stable ethernet connections - especially when the geometry coupled with the data is declared. In this lab, we are calling the data <em>without</em> geometry so the chances are lower that a failed return will result. However, if errors are reported, and the data is unable to return, the following script and backup data endpoint can be utilized to load the lab backup data <em>after</em> it is uncompressed.</p>
</div>
</div>
<ul>
<li><p><a href="https://weekly-materials.s3.us-west-1.amazonaws.com/lab_3_backup-data.zip">lab 3 backup data (compressed)</a></p></li>
<li><p>code line for loading uncompressed data; use setwd() as needed:</p></li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb12-1"><a href="#cb12-1"></a>load("ny_housing.RData"); load("ny_population.RData"); load("pop_data.RData"); load("race.RData"); load("urban_rural.RData")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>the <code>tidycensus</code> package is very well maintained and has invaluable guidance documentation, particularly useful in establishing your API calls. Access <a href="https://walker-data.com/tidycensus/">HERE</a></p>
</div>
</div>
<p>Follow the call by viewing the head:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb13-1"><a href="#cb13-1"></a>head(pop_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c3_lab_files/img/3_head.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>head(pop_data)</em></figcaption><p></p>
</figure>
</div>
<p>Next, we will use base <code>ggplot</code> which is bundled with <code>tidyverse</code> to show the results of the API call for state populations. Note the <code>%&gt;%</code> operator - the first time we’ve used this critical <code>tidyverse</code> capability:</p>
<blockquote class="blockquote">
<p>The <code>%&gt;%</code> operator, also known as the pipe operator, is a widely used feature in the R programming language, particularly within the Tidyverse ecosystem. It originates from the <code>magrittr</code> package. Its primary function is to chain together a sequence of operations by taking the output of one function or expression and passing it as the first argument to the next function in the chain. This creates a more readable and intuitive flow for data transformations and analyses, resembling a “pipeline” of operations.</p>
</blockquote>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb14-1"><a href="#cb14-1"></a>pop_data %&gt;%</span>
<span id="cb14-2"><a href="#cb14-2"></a>  ggplot(aes(x = reorder(NAME, value), y = value)) +</span>
<span id="cb14-3"><a href="#cb14-3"></a>  geom_col() +</span>
<span id="cb14-4"><a href="#cb14-4"></a>  coord_flip() +</span>
<span id="cb14-5"><a href="#cb14-5"></a>  labs(title="Population by State, 2020") </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, we will make a call on the <code>dhc</code> file which has a rural and urban designation:</p>
<blockquote class="blockquote">
<p>For the 2020 Census, an urban area is a densely settled territory that meets specific population and housing density thresholds. A core cluster of census blocks must encompass one of the following to qualify:</p>
</blockquote>
<blockquote class="blockquote">
<p>A minimum of 2,000 housing units.</p>
</blockquote>
<blockquote class="blockquote">
<p>A population of at least 5,000 people.</p>
</blockquote>
<blockquote class="blockquote">
<p>Urban areas can include adjacent land uses, like residential or commercial areas, as long as they meet the required density criteria.</p>
</blockquote>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb15-1"><a href="#cb15-1"></a>urban_rural &lt;- get_decennial(</span>
<span id="cb15-2"><a href="#cb15-2"></a>  geography = "us",</span>
<span id="cb15-3"><a href="#cb15-3"></a>  variables = c("P2_002N","P2_003N"),</span>
<span id="cb15-4"><a href="#cb15-4"></a>  year = 2020,</span>
<span id="cb15-5"><a href="#cb15-5"></a>  sumfile = "dhc")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c3_lab_files/img/3_head-urban-rural.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>head(urban_rural)</em></figcaption><p></p>
</figure>
</div>
<p>Next, we pass <code>urban_rural</code> <code>tibble</code> to a <code>mutate</code> function to rename the variables to <code>Urban</code> and <code>Rural</code>, then to <code>ggplot</code> with parameters for the plotting:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb16-1"><a href="#cb16-1"></a>urban_rural %&gt;%</span>
<span id="cb16-2"><a href="#cb16-2"></a>  mutate(name = recode(variable, P2_002N = "Urban", P2_003N = "Rural")) |&gt;</span>
<span id="cb16-3"><a href="#cb16-3"></a>  ggplot(aes(x = name, y = value)) +</span>
<span id="cb16-4"><a href="#cb16-4"></a>  geom_col() +</span>
<span id="cb16-5"><a href="#cb16-5"></a>  labs(title = "Rural vs Urban Population (2020)", x = NULL, y = "Population") +</span>
<span id="cb16-6"><a href="#cb16-6"></a>  theme_minimal() + scale_y_continuous(labels = scales::comma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-6" class="level4">
<h4 class="anchored" data-anchor-id="step-6">Step 6:</h4>
<p>With some practice with first calling census data and then plotting the results, we will move along to another geography at the state level.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb17-1"><a href="#cb17-1"></a>ny_population &lt;- get_decennial(</span>
<span id="cb17-2"><a href="#cb17-2"></a>  geography = "county",</span>
<span id="cb17-3"><a href="#cb17-3"></a>  variables = "P1_001N", # Total Population</span>
<span id="cb17-4"><a href="#cb17-4"></a>  state = "NY",</span>
<span id="cb17-5"><a href="#cb17-5"></a>  year = 2020, #desired decennial year</span>
<span id="cb17-6"><a href="#cb17-6"></a>  geometry = FALSE #no need for spatial data for a bar chart</span>
<span id="cb17-7"><a href="#cb17-7"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We will clean up the resulting county names with the following code. Note here that we utilize <code>$</code> to first declare the dataframe, then the specific column upon which to run the code. this code substitutes the declaration with ““, or rather nothing, and just returns the resulting county name alone:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb18-1"><a href="#cb18-1"></a>ny_population$NAME &lt;- gsub(" County, New York", "", ny_population$NAME)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, for the population value, we reorder this value from large to small (decreasing) for a size-sequence plot:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb19-1"><a href="#cb19-1"></a>ny_population$NAME &lt;- gsub(" County, New York", "", ny_population$NAME)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we are ready to plot, this time with just base R, not utilizing our installed packages:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb20-1"><a href="#cb20-1"></a>barplot(</span>
<span id="cb20-2"><a href="#cb20-2"></a>  height = ny_population$value,</span>
<span id="cb20-3"><a href="#cb20-3"></a>  names.arg = ny_population$NAME,</span>
<span id="cb20-4"><a href="#cb20-4"></a>  main = "Total Population of New York State Counties (2020 Census)",</span>
<span id="cb20-5"><a href="#cb20-5"></a>  xlab = "County",</span>
<span id="cb20-6"><a href="#cb20-6"></a>  ylab = "Total Population",</span>
<span id="cb20-7"><a href="#cb20-7"></a>  col = "skyblue", #optional: Set bar color</span>
<span id="cb20-8"><a href="#cb20-8"></a>  las = 2, #rotate x-axis labels vertically for readability</span>
<span id="cb20-9"><a href="#cb20-9"></a>  cex.names = 0.7 #adjust label size if needed</span>
<span id="cb20-10"><a href="#cb20-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, we can utilize the same input data, but create a new version of the plot using <code>ggplot</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb21-1"><a href="#cb21-1"></a>ggplot(ny_population, aes(x = reorder(NAME, value), y = value)) +</span>
<span id="cb21-2"><a href="#cb21-2"></a>  geom_col(fill = "#56B4E9") +</span>
<span id="cb21-3"><a href="#cb21-3"></a>  coord_flip() +</span>
<span id="cb21-4"><a href="#cb21-4"></a>  scale_y_continuous(labels = scales::comma) + # Format y-axis with commas</span>
<span id="cb21-5"><a href="#cb21-5"></a>  labs(</span>
<span id="cb21-6"><a href="#cb21-6"></a>    title = "New York County Populations (2020 Decennial Census)",</span>
<span id="cb21-7"><a href="#cb21-7"></a>    subtitle = "Source: U.S. Census Bureau",</span>
<span id="cb21-8"><a href="#cb21-8"></a>    x = "County",</span>
<span id="cb21-9"><a href="#cb21-9"></a>    y = "Total Population"</span>
<span id="cb21-10"><a href="#cb21-10"></a>  ) +</span>
<span id="cb21-11"><a href="#cb21-11"></a>  theme_classic() +</span>
<span id="cb21-12"><a href="#cb21-12"></a>  theme(</span>
<span id="cb21-13"><a href="#cb21-13"></a>    plot.title = element_text(face = "bold"),</span>
<span id="cb21-14"><a href="#cb21-14"></a>    axis.text.y = element_text(size = 8)</span>
<span id="cb21-15"><a href="#cb21-15"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-7" class="level4">
<h4 class="anchored" data-anchor-id="step-7">Step 7:</h4>
<p>For the final component of this week’s lab, we will turn to race categories collected via the US Decennial Census 2020. To start, we need to address <code>GEOID</code> structures. We will have discussed these during this week’s lecture, and here we will apply their specifications to the geography call. We will also do a version of this process in the class 3 assignment.</p>
<p>To start, note the following GEOID codes for the 5 counties (boroughs) of NYC:</p>
<ul>
<li>Bronx = <code>36005</code></li>
<li>Kings (Brooklyn) = <code>36047</code></li>
<li>New York (Manhattan) = <code>36061</code></li>
<li>Queens = <code>36081</code></li>
<li>Richmond (Staten Island) = <code>36085</code></li>
</ul>
<p>We will also be using the following 8 named variables:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c3_lab_files/img/3_race-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>pl variables - base race categories</em></figcaption><p></p>
</figure>
</div>
<p>First we define and name the columns is a character vector:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb22-1"><a href="#cb22-1"></a>race_vars &lt;- c(</span>
<span id="cb22-2"><a href="#cb22-2"></a>  Total = "P1_001N",</span>
<span id="cb22-3"><a href="#cb22-3"></a>  White = "P1_003N",</span>
<span id="cb22-4"><a href="#cb22-4"></a>  Black = "P1_004N",</span>
<span id="cb22-5"><a href="#cb22-5"></a>  American_Indian = "P1_005N",</span>
<span id="cb22-6"><a href="#cb22-6"></a>  Asian = "P1_006N",</span>
<span id="cb22-7"><a href="#cb22-7"></a>  Pacific_Islander = "P1_007N",</span>
<span id="cb22-8"><a href="#cb22-8"></a>  Other_Race = "P1_008N",</span>
<span id="cb22-9"><a href="#cb22-9"></a>  Two_or_More_Races = "P1_009N"</span>
<span id="cb22-10"><a href="#cb22-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next we declare a new dataframe <code>race</code>. Note that we choose the <code>wide</code> output which is part/parcel of the tidyverse optimized structure:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb23-1"><a href="#cb23-1"></a>race &lt;- get_decennial(</span>
<span id="cb23-2"><a href="#cb23-2"></a>  geography = "county",</span>
<span id="cb23-3"><a href="#cb23-3"></a>  variables = race_vars,</span>
<span id="cb23-4"><a href="#cb23-4"></a>  state = "NY",</span>
<span id="cb23-5"><a href="#cb23-5"></a>  year = 2020,</span>
<span id="cb23-6"><a href="#cb23-6"></a>  sumfile = "pl", # Specify the Redistricting Summary File</span>
<span id="cb23-7"><a href="#cb23-7"></a>  output = "wide" # Get data in a wide format</span>
<span id="cb23-8"><a href="#cb23-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we filter down all NY state counties to just the 5 NYC boroughs using the <code>GEOID</code> specific to each borough:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb24-1"><a href="#cb24-1"></a>nyc_race &lt;- race %&gt;%</span>
<span id="cb24-2"><a href="#cb24-2"></a>  filter(GEOID %in% c("36005","36047","36061","36081","36085"))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The next code chunk does a fair amount of work by first calculating percentages for each race category; create a new naming variable for the boroughs for legibility in the final plot, also setting and ordering the race names to the factor format:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb25-1"><a href="#cb25-1"></a>nyc_race_pct &lt;- nyc_race %&gt;%</span>
<span id="cb25-2"><a href="#cb25-2"></a>  # Select relevant columns and calculate the percentage for each race</span>
<span id="cb25-3"><a href="#cb25-3"></a>  mutate(</span>
<span id="cb25-4"><a href="#cb25-4"></a>    White_pct = White / Total,</span>
<span id="cb25-5"><a href="#cb25-5"></a>    Black_pct = Black / Total,</span>
<span id="cb25-6"><a href="#cb25-6"></a>    American_Indian_pct = American_Indian / Total,</span>
<span id="cb25-7"><a href="#cb25-7"></a>    Asian_pct = Asian / Total,</span>
<span id="cb25-8"><a href="#cb25-8"></a>    Pacific_Islander_pct = Pacific_Islander / Total,</span>
<span id="cb25-9"><a href="#cb25-9"></a>    Other_Race_pct = Other_Race / Total,</span>
<span id="cb25-10"><a href="#cb25-10"></a>    Two_or_More_Races_pct = Two_or_More_Races / Total</span>
<span id="cb25-11"><a href="#cb25-11"></a>  ) %&gt;%</span>
<span id="cb25-12"><a href="#cb25-12"></a>  # Select only the borough name and percentage columns</span>
<span id="cb25-13"><a href="#cb25-13"></a>  select(NAME, ends_with("_pct")) %&gt;%</span>
<span id="cb25-14"><a href="#cb25-14"></a>  # Reshape from wide to long format for plotting</span>
<span id="cb25-15"><a href="#cb25-15"></a>  pivot_longer(</span>
<span id="cb25-16"><a href="#cb25-16"></a>    cols = ends_with("_pct"),</span>
<span id="cb25-17"><a href="#cb25-17"></a>    names_to = "Race_Category",</span>
<span id="cb25-18"><a href="#cb25-18"></a>    values_to = "Percentage"</span>
<span id="cb25-19"><a href="#cb25-19"></a>  ) %&gt;%</span>
<span id="cb25-20"><a href="#cb25-20"></a>  # Rename NAME column to Borough and clean up the Race_Category names</span>
<span id="cb25-21"><a href="#cb25-21"></a>  mutate(</span>
<span id="cb25-22"><a href="#cb25-22"></a>    Borough = case_when(</span>
<span id="cb25-23"><a href="#cb25-23"></a>      NAME == "Bronx County, New York" ~ "The Bronx",</span>
<span id="cb25-24"><a href="#cb25-24"></a>      NAME == "Kings County, New York" ~ "Brooklyn",</span>
<span id="cb25-25"><a href="#cb25-25"></a>      NAME == "New York County, New York" ~ "Manhattan",</span>
<span id="cb25-26"><a href="#cb25-26"></a>      NAME == "Queens County, New York" ~ "Queens",</span>
<span id="cb25-27"><a href="#cb25-27"></a>      NAME == "Richmond County, New York" ~ "Staten Island",</span>
<span id="cb25-28"><a href="#cb25-28"></a>      TRUE ~ NAME</span>
<span id="cb25-29"><a href="#cb25-29"></a>    ),</span>
<span id="cb25-30"><a href="#cb25-30"></a>    Race_Category = str_replace(Race_Category, "_pct", "") %&gt;%</span>
<span id="cb25-31"><a href="#cb25-31"></a>      str_replace_all("_", " ") %&gt;%</span>
<span id="cb25-32"><a href="#cb25-32"></a>      # Reorder the levels of race categories</span>
<span id="cb25-33"><a href="#cb25-33"></a>      factor(levels = c(</span>
<span id="cb25-34"><a href="#cb25-34"></a>        "White", "Black", "Asian", "American Indian", "Pacific Islander",</span>
<span id="cb25-35"><a href="#cb25-35"></a>        "Other Race", "Two or More Races"</span>
<span id="cb25-36"><a href="#cb25-36"></a>      ))</span>
<span id="cb25-37"><a href="#cb25-37"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Before proceeding to the plot, we’ll review the resulting structure:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c3_lab_files/img/3-head-pct.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em><code>head(nyc_race_pct)</code></em></figcaption><p></p>
</figure>
</div>
<p>Next, the plot will be performed:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb26-1"><a href="#cb26-1"></a>ggplot(nyc_race_pct, aes(x = Borough, y = Percentage, fill = Race_Category)) +</span>
<span id="cb26-2"><a href="#cb26-2"></a>  geom_bar(stat = "identity", position = "fill") +</span>
<span id="cb26-3"><a href="#cb26-3"></a>  labs(</span>
<span id="cb26-4"><a href="#cb26-4"></a>    title = "Racial Composition of NYC Boroughs (2020 Census)",</span>
<span id="cb26-5"><a href="#cb26-5"></a>    x = "Borough",</span>
<span id="cb26-6"><a href="#cb26-6"></a>    y = "Percentage",</span>
<span id="cb26-7"><a href="#cb26-7"></a>    fill = "Race Category",</span>
<span id="cb26-8"><a href="#cb26-8"></a>    caption = "Source: 2020 US Decennial Census, PL 94-171"</span>
<span id="cb26-9"><a href="#cb26-9"></a>  ) +</span>
<span id="cb26-10"><a href="#cb26-10"></a>  scale_y_continuous(labels = scales::percent) +</span>
<span id="cb26-11"><a href="#cb26-11"></a>  theme_fivethirtyeight() + # Use a clean, readable theme</span>
<span id="cb26-12"><a href="#cb26-12"></a>  theme(</span>
<span id="cb26-13"><a href="#cb26-13"></a>    plot.title = element_text(hjust = 0.5, face = "bold"),</span>
<span id="cb26-14"><a href="#cb26-14"></a>    axis.title.y = element_text(face = "bold"),</span>
<span id="cb26-15"><a href="#cb26-15"></a>    legend.position = "right"</span>
<span id="cb26-16"><a href="#cb26-16"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c3_lab_files/img/3-plot.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>Racial Composition of NYC Boroughs (2020 Census)</em></figcaption><p></p>
</figure>
</div>
<p>With main section of the <code>lab_3</code> complete, we can save any of the dataframes that have been developed for use at a later point. The following code shows both saving the reloading the NY county raw race data prior to wrangling and reshaping that dataframe.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb27-1"><a href="#cb27-1"></a>save(race, file = "results/race.RData")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb28-1"><a href="#cb28-1"></a>load("results/race.RData")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="extra-section---housing-data-time-permitting" class="level2">
<h2 class="anchored" data-anchor-id="extra-section---housing-data-time-permitting">Extra Section - Housing Data (time permitting)</h2>
<p>Thus far in the lab, we have been working with population variables, not housing variables.</p>
<blockquote class="blockquote">
<p>The Census Bureau collects and releases both population and housing data together to provide a comprehensive overview of the nation’s demographics and housing trends. This data is found in the Demographic and Housing Characteristics File (DHC). Items in the file:</p>
</blockquote>
<ul>
<li>The total number of housing units.</li>
<li>The number of occupied housing units.</li>
<li>The number of vacant housing units.</li>
<li>Characteristics of housing, such as whether a home is owned or rented and the type of structure.</li>
</ul>
<p>In the next <code>tidycensus</code> API call, both occupied and vacant variables are collected per NY state county in the wide format. It is often the case that dataframes will be either reshaped in the <code>longer</code> format or the <code>wider</code> format depending on the specific purpose</p>
<blockquote class="blockquote">
<p>pivot_longer():</p>
</blockquote>
<blockquote class="blockquote">
<p>Converts data from wide to long format. It takes multiple columns and “pivots” them into two new columns: one containing the original column names (now as values representing the measurement type) and another containing the corresponding values.</p>
</blockquote>
<blockquote class="blockquote">
<p>pivot_wider():</p>
</blockquote>
<blockquote class="blockquote">
<p>Converts data from long to wide format. It takes a column containing measurement types and a column containing values, and “pivots” them to create new columns for each measurement type, with the corresponding values filling those columns.</p>
</blockquote>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb29-1"><a href="#cb29-1"></a>ny_housing &lt;- get_decennial(</span>
<span id="cb29-2"><a href="#cb29-2"></a>  geography = "county",</span>
<span id="cb29-3"><a href="#cb29-3"></a>  variables = c(</span>
<span id="cb29-4"><a href="#cb29-4"></a>    occupied = "H1_002N",</span>
<span id="cb29-5"><a href="#cb29-5"></a>    vacant   = "H1_003N"</span>
<span id="cb29-6"><a href="#cb29-6"></a>  ),</span>
<span id="cb29-7"><a href="#cb29-7"></a>  state = "NY",</span>
<span id="cb29-8"><a href="#cb29-8"></a>  year = 2020,</span>
<span id="cb29-9"><a href="#cb29-9"></a>  output = "wide")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, the data is reshaped to the <code>long</code> format prior to plotting:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb30-1"><a href="#cb30-1"></a>ny_housing_long &lt;- ny_housing %&gt;%</span>
<span id="cb30-2"><a href="#cb30-2"></a>  pivot_longer(</span>
<span id="cb30-3"><a href="#cb30-3"></a>    cols = c(occupied, vacant),</span>
<span id="cb30-4"><a href="#cb30-4"></a>    names_to = "status",</span>
<span id="cb30-5"><a href="#cb30-5"></a>    values_to = "count"</span>
<span id="cb30-6"><a href="#cb30-6"></a>  ) %&gt;%</span>
<span id="cb30-7"><a href="#cb30-7"></a>  group_by(NAME) %&gt;%</span>
<span id="cb30-8"><a href="#cb30-8"></a>  mutate(percentage = count / sum(count))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, utilzing <code>ggplot</code>, with the <code>ggthemes</code> package to set the style to <code>theme_minimal()</code>:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb31-1"><a href="#cb31-1"></a>ggplot(ny_housing_long, aes(x = reorder(NAME, -count, sum), y = count, fill = status)) +</span>
<span id="cb31-2"><a href="#cb31-2"></a>  geom_bar(stat = "identity", position = "stack") +</span>
<span id="cb31-3"><a href="#cb31-3"></a>  labs(</span>
<span id="cb31-4"><a href="#cb31-4"></a>    title = "Vacant vs. Occupied Housing Units in New York State Counties (2020)",</span>
<span id="cb31-5"><a href="#cb31-5"></a>    x = "County",</span>
<span id="cb31-6"><a href="#cb31-6"></a>    y = "Number of Units",</span>
<span id="cb31-7"><a href="#cb31-7"></a>    fill = "Housing Status"</span>
<span id="cb31-8"><a href="#cb31-8"></a>  ) +</span>
<span id="cb31-9"><a href="#cb31-9"></a>  scale_fill_manual(values = c("occupied" = "steelblue", "vacant" = "orange")) +</span>
<span id="cb31-10"><a href="#cb31-10"></a>  theme_minimal() +</span>
<span id="cb31-11"><a href="#cb31-11"></a>  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +  scale_y_continuous(labels = scales::comma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="concluding-remarks" class="level2">
<h2 class="anchored" data-anchor-id="concluding-remarks">Concluding Remarks</h2>
<p>In this third demonstration lab, we moved past base R functions alone, including several valuable packages that work well for accessing, wrangling and visualizing US Census data. In this week’s <a href="https://tns-course-repositories.github.io/Methods_1-PGUD5160-DUE-Program-fall25/assignments-labs/c3_assignment">third assignment</a>, many of the steps we’ve covered here will be explored further for a specific purpose at the census tract level in New York City. Access this lab as needed for review and preparation for <a href="https://tns-course-repositories.github.io/Methods_1-PGUD5160-DUE-Program-fall25/assignments-labs/c3_assignment">assignment 3</a>.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References:</h2>
<ul>
<li><a href="https://intro2r.com/graphics_base_r.html">intro2r - base R graphics</a></li>
<li><a href="https://r-graph-gallery.com/cheatsheets">tidyverse cheatsheets</a></li>
<li><a href="https://walker-data.com/tidycensus/">tidycensus usage</a></li>
<li><a href="https://rstudio.github.io/cheatsheets/html/data-visualization.html">ggplot2 cheatsheet</a></li>
<li><a href="https://jrnold.github.io/ggthemes/">ggthemes overview</a></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp(/^(?:http:|https:)\/\/www\.quarto\.org\/custom/);
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



<script src="c3_lab_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>