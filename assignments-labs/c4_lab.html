<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-09-15">

<title>Class 4 Lab: Working with US Census American Community Survey Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="c4_lab_files/libs/clipboard/clipboard.min.js"></script>
<script src="c4_lab_files/libs/quarto-html/quarto.js"></script>
<script src="c4_lab_files/libs/quarto-html/popper.min.js"></script>
<script src="c4_lab_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="c4_lab_files/libs/quarto-html/anchor.min.js"></script>
<link href="c4_lab_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="c4_lab_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="c4_lab_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="c4_lab_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="c4_lab_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="c4_lab_files/styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#preamble" id="toc-preamble" class="nav-link active" data-scroll-target="#preamble">Preamble</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#step-1-project-management-in-rstudio-for-lab_4-also-applicable-for-assignment_4" id="toc-step-1-project-management-in-rstudio-for-lab_4-also-applicable-for-assignment_4" class="nav-link" data-scroll-target="#step-1-project-management-in-rstudio-for-lab_4-also-applicable-for-assignment_4">Step 1: Project Management in RStudio for <code>lab_4</code> (also applicable for <code>assignment_4</code>)</a></li>
  <li><a href="#script-1-eda-for-manhattan-acs-data-2023-5-year-survey" id="toc-script-1-eda-for-manhattan-acs-data-2023-5-year-survey" class="nav-link" data-scroll-target="#script-1-eda-for-manhattan-acs-data-2023-5-year-survey">Script 1: EDA for Manhattan ACS Data 2023 5-Year Survey</a></li>
  <li><a href="#script-2-mapping-census-block-groups-in-manhattan-cd03" id="toc-script-2-mapping-census-block-groups-in-manhattan-cd03" class="nav-link" data-scroll-target="#script-2-mapping-census-block-groups-in-manhattan-cd03">Script 2: Mapping Census Block Groups in Manhattan CD03</a></li>
  <li><a href="#script-3-4-working-with-acs-data-across-time-time-series-analysis-comparison-chart-for-poverty-rates" id="toc-script-3-4-working-with-acs-data-across-time-time-series-analysis-comparison-chart-for-poverty-rates" class="nav-link" data-scroll-target="#script-3-4-working-with-acs-data-across-time-time-series-analysis-comparison-chart-for-poverty-rates">Script 3 &amp; 4: Working with ACS Data Across Time (Time Series Analysis) + Comparison Chart for Poverty Rates</a></li>
  <li><a href="#extra---time-permitting-script-5-6-working-with-acs-data-across-time-time-series-analysis-comparison-chart-for-rent-burden" id="toc-extra---time-permitting-script-5-6-working-with-acs-data-across-time-time-series-analysis-comparison-chart-for-rent-burden" class="nav-link" data-scroll-target="#extra---time-permitting-script-5-6-working-with-acs-data-across-time-time-series-analysis-comparison-chart-for-rent-burden">(Extra - Time Permitting) Script 5 &amp; 6: Working with ACS Data Across Time (Time Series Analysis) + Comparison Chart for Rent Burden</a></li>
  <li><a href="#saving-data-for-assignment-4" id="toc-saving-data-for-assignment-4" class="nav-link" data-scroll-target="#saving-data-for-assignment-4">Saving Data for Assignment 4:</a></li>
  <li><a href="#concluding-remarks" id="toc-concluding-remarks" class="nav-link" data-scroll-target="#concluding-remarks">Concluding Remarks</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References:</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Class 4 Lab: Working with US Census American Community Survey Data</h1>
<p class="subtitle lead">Fall 2025 | Instructor: Stephen Metts | <a href="https://courses.newschool.edu/courses/PGUD5160/">PGUD 5160 - CRN 2247</a></p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 15, 2025</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="preamble" class="level2">
<h2 class="anchored" data-anchor-id="preamble">Preamble</h2>
<p>In this fourth demonstration lab, we will repeat the project setup phase of the 3nd week (setting the working directory to <code>lab_4</code>) then move along to accessing US Census data - specifically estimates from the American Community Survey (ACS), followed by visualizing the data at various scales in NYC. This lab can and should be used in conjunction with this weekâ€™s assignment 4 deliverable - <a href="https://tns-course-repositories.github.io/Methods_1-PGUD5160-DUE-Program-fall25/assignments-labs/c4_assignment">Assignment 4</a>.</p>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>Last week we utilized the a Census API Key located <a href="https://api.census.gov/data/key_signup.html">HERE</a> to first <code>Request a KEY</code>, secure that key and then propagate it into the <code>tidycensus</code> pulls that we did for both the lab and assignment. We will utilize the same key this week. Remember if you have set the <code>census_api_key("YOUR KEY GOES HERE", install = TRUE)</code> indeed to <code>TRUE</code>, your key should presist into future sessions. If for some reason you return API key errors, certainly reinstall the key in the early part of this fourth week lab.</p>
<p>While the variables that we will be analyzing this week vary from script to script that we will be using, the underlining data will remain the same except for the time series analyses in which we will access previous years of ACS data. Generally we will be utilizing the following ACS 5-year Estimate for the latest period available which is 2023. The next 5-year estimate will be issued as follows:</p>
<blockquote class="blockquote">
<p>The ACS 5-year survey in 2025 will include the new 2020-2024 ACS 5-year Estimates, released in December 2025.</p>
</blockquote>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb1-1"><a href="#cb1-1"></a>library(tidycensus)</span>
<span id="cb1-2"><a href="#cb1-2"></a>vars &lt;- load_variables(2021, "acs5", cache = TRUE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-1-project-management-in-rstudio-for-lab_4-also-applicable-for-assignment_4" class="level2">
<h2 class="anchored" data-anchor-id="step-1-project-management-in-rstudio-for-lab_4-also-applicable-for-assignment_4">Step 1: Project Management in RStudio for <code>lab_4</code> (also applicable for <code>assignment_4</code>)</h2>
<p>As we have done for previous labs, we will create a <code>lab_4</code> project directory:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c4_lab_files/img/4-structure.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>Lab 4 Directory + Subdirectory Structure</em></figcaption><p></p>
</figure>
</div>
<p>A well-organized folder structure within an RStudio project is crucial. Common conventions include:</p>
<p><code>data/</code>: For raw data (treated as read-only).</p>
<p><code>docs/</code>: For documentation or R Markdown files.</p>
<p><code>results/</code>: For outputs and generated results.</p>
<p><code>scripts/</code>: For R scripts and analysis pipelines.</p>
<p><code>docs/</code>: For documentation or R Markdown files.</p>
<section id="step-2" class="level4">
<h4 class="anchored" data-anchor-id="step-2">Step 2:</h4>
<p>With the <code>lab_4.Rproj</code> established and the subdirectories for our data analysis established, we can move along to working on the code steps for US Census ACS data.</p>
<ul>
<li>Download the first of six scripts (you can also access <strong>all</strong> six scripts at bottom of lab and download all into <code>scripts/</code>) <a href="https://github.com/tns-course-repositories/Methods_1-PGUD5160-DUE-Program-fall25/blob/main/scripts/c4_lab4-script-1.R">Class 4 Lab 4 R Script #1</a>; open this script into your current working environment.</li>
</ul>
<p>To start, check the current directory and make sure its what you expect:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1"><a href="#cb2-1"></a>get(wd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb3-1"><a href="#cb3-1"></a>list.files("~/Desktop/lab_4", recursive = TRUE, include.dirs = TRUE, full.names = TRUE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This should return the expected <code>lab_4</code> project directory.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c4_lab_files/img/4-wd.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>Checking the working directory</em></figcaption><p></p>
</figure>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Your â€˜upstreamâ€™ path will likely be different than <code>Users/x15</code>â€¦ if you are using macOS, your full path would be akin to <code>/Users/your_machine_name/Desktop/lab_4</code>. On macOS, this can also be expressed as <code>~/Desktop/lab_4</code>:</p>
<blockquote class="blockquote">
<p>The tilde ~ is a special character that acts as a shortcut for the current userâ€™s home directory.</p>
</blockquote>
<p>This is fine; we want to simply make sure that the directory we created - <code>lab_4</code> is indeed the directory in which and from which we are and will be working.</p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This lab, like the course generally, utilizes macOS file path conventions. Windows users need to adjust for this difference between their OS conventions and macOS. Windows utilizes the opposite â€˜backwardâ€™ slash convention as well as naming explicitly the drive location: Windows: <code>C:\Users\username\Desktop\lab_4</code> Linux/macOS: <code>/Users/username/Desktop/lab_4</code></p>
</div>
</div>
</section>
<section id="step-3" class="level4">
<h4 class="anchored" data-anchor-id="step-3">Step 3:</h4>
<p>For this weekâ€™s lab, we will need <code>tidycensus</code>, <code>tidyverse</code>, <code>sf</code> and the <code>gt</code> package. As we have already loaded <code>tidycensus</code> and <code>tidyverse</code> from <code>lab3</code>, we really only need to install <code>sf</code> and <code>gt</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb4-1"><a href="#cb4-1"></a>install.packages("sf")</span>
<span id="cb4-2"><a href="#cb4-2"></a>install.packages("gt")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="script-1-eda-for-manhattan-acs-data-2023-5-year-survey" class="level2">
<h2 class="anchored" data-anchor-id="script-1-eda-for-manhattan-acs-data-2023-5-year-survey">Script 1: EDA for Manhattan ACS Data 2023 5-Year Survey</h2>
<section id="step-1" class="level4">
<h4 class="anchored" data-anchor-id="step-1">Step 1:</h4>
<p>Make sure <a href="https://github.com/tns-course-repositories/Methods_1-PGUD5160-DUE-Program-fall25/blob/main/scripts/c4_lab4-script-1.R">Class 4 Lab 4 R Script #1</a> is open in your RStudio <code>scripts</code> <em>File&gt;Open File&gt;lab_4&gt;scripts&gt;c4_lab4-script-1.r</em></p>
<p>In this first script, we will conduct several EDA analyses and resulting visualizations in order to explore some fundamental particularities of the ACS data. To start, we set options to cache the ACS data geometries, and set those geometries to <code>TRUE</code>. This will give us both the data and the geometries. We are, in part, utilizing PUMAs in this first script:</p>
<blockquote class="blockquote">
<p>Public Use Microdata Areas (PUMAs) are non-overlapping statistical geographic areas used by the U.S. Census Bureau to release Public Use Microdata Sample (PUMS) data, ensuring each area has at least 100,000 people for privacy protection. PUMAs partition each state into these minimum-population areas, are built from census tracts, and do not cross state boundaries. They are updated following each decennial census</p>
</blockquote>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb5-1"><a href="#cb5-1"></a></span>
<span id="cb5-2"><a href="#cb5-2"></a># Get Median Household Income by PUMA (New York County Manhattan)----</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a>options(tigris_use_cache = TRUE, tigris_class = "sf")</span>
<span id="cb5-5"><a href="#cb5-5"></a></span>
<span id="cb5-6"><a href="#cb5-6"></a># Download ACS data for NY PUMAs</span>
<span id="cb5-7"><a href="#cb5-7"></a>income_puma &lt;- get_acs(</span>
<span id="cb5-8"><a href="#cb5-8"></a>  geography = "puma",</span>
<span id="cb5-9"><a href="#cb5-9"></a>  variables = "B19013_001", # Median household income</span>
<span id="cb5-10"><a href="#cb5-10"></a>  state = "NY",</span>
<span id="cb5-11"><a href="#cb5-11"></a>  year = 2023,</span>
<span id="cb5-12"><a href="#cb5-12"></a>  survey = "acs5",</span>
<span id="cb5-13"><a href="#cb5-13"></a>  geometry = TRUE</span>
<span id="cb5-14"><a href="#cb5-14"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next we clean and organize the returned data and call it <code>income_clean</code>. We then filter the data for just those PUMAs in <em>Manhattan</em> and utilize <code>ggplot</code> to show those boundaries. Keep in mind that if we set the <code>geometry = FALSE</code> we would not be able to show these boundaries.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>census calls via <code>tidycensus</code> can fail - particularly on wifi vs more stable ethernet connections - especially when the geometry coupled with the data is declared. However, if errors are reported, and the data is unable to return, the following script and backup data endpoint can be utilized to load the lab backup data <em>after</em> it is uncompressed.</p>
</div>
</div>
<ul>
<li><p><a href="https://weekly-materials.s3.us-west-1.amazonaws.com/lab_4_backup-data.zip">lab 4 backup data (compressed)</a></p></li>
<li><p>code line for loading uncompressed data; use setwd() as needed to augment the data paths:</p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb6-1"><a href="#cb6-1"></a>load("income_manhattan.RData"); load(".RData"); load(".RData"); load(".RData"); load(".RData")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In the next EDA visualization, we will access the variable via the previous <code>variables = "B19013_001"</code> which is the Median Household Income variable. This is a simple structure variable in ACS in that it features just one value per each geographic entity which could be anything from a census block group all the way up to the nation aggregation. Here again we are pulling the PUMAs which for Manhattan is pretty aggregated relative to a census block group or even census tract.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb7-1"><a href="#cb7-1"></a></span>
<span id="cb7-2"><a href="#cb7-2"></a># Bar chart with error bars + MOE labels</span>
<span id="cb7-3"><a href="#cb7-3"></a>ggplot(income_manhattan, aes(x = reorder(NAME, median_income), y = median_income)) +</span>
<span id="cb7-4"><a href="#cb7-4"></a>  geom_col(fill = "steelblue") +</span>
<span id="cb7-5"><a href="#cb7-5"></a>  geom_errorbar(</span>
<span id="cb7-6"><a href="#cb7-6"></a>    aes(ymin = median_income - moe_income, ymax = median_income + moe_income),</span>
<span id="cb7-7"><a href="#cb7-7"></a>    width = 0.2, color = "black"</span>
<span id="cb7-8"><a href="#cb7-8"></a>  ) +</span>
<span id="cb7-9"><a href="#cb7-9"></a>  coord_flip() +</span>
<span id="cb7-10"><a href="#cb7-10"></a>  labs(</span>
<span id="cb7-11"><a href="#cb7-11"></a>    title = "Median Household Income by PUMA (Manhattan, ACS 2023)",</span>
<span id="cb7-12"><a href="#cb7-12"></a>    x = "Public Use Microdata Area (PUMA)",</span>
<span id="cb7-13"><a href="#cb7-13"></a>    y = "Median Household Income (USD)",</span>
<span id="cb7-14"><a href="#cb7-14"></a>    caption = "Source: U.S. Census Bureau, ACS 2023 5-year estimates\nBlack lines show the ACS margin of error (MOE) at 90% confidence."</span>
<span id="cb7-15"><a href="#cb7-15"></a>  ) +</span>
<span id="cb7-16"><a href="#cb7-16"></a>  theme_minimal(base_size = 12) +</span>
<span id="cb7-17"><a href="#cb7-17"></a>  theme(</span>
<span id="cb7-18"><a href="#cb7-18"></a>    plot.title = element_text(face = "bold", hjust = 0.5),</span>
<span id="cb7-19"><a href="#cb7-19"></a>    plot.caption = element_text(size = 9, hjust = 0)</span>
<span id="cb7-20"><a href="#cb7-20"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, we will get a glimpse of the type of work we will be doing in <strong>Class 5</strong> - actually mapping variables through cartographic visualization:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb8-1"><a href="#cb8-1"></a># Mapping of the Income Distribution across PUMAs ----</span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a># Plot map</span>
<span id="cb8-4"><a href="#cb8-4"></a>ggplot(income_manhattan, aes(fill = median_income)) +</span>
<span id="cb8-5"><a href="#cb8-5"></a>  geom_sf(color = "white") +</span>
<span id="cb8-6"><a href="#cb8-6"></a>  scale_fill_viridis_c(option = "plasma") +</span>
<span id="cb8-7"><a href="#cb8-7"></a>  labs(</span>
<span id="cb8-8"><a href="#cb8-8"></a>    title = "Median Household Income by PUMA (Manhattan, ACS 2023)",</span>
<span id="cb8-9"><a href="#cb8-9"></a>    fill = "Income (USD)"</span>
<span id="cb8-10"><a href="#cb8-10"></a>  ) +</span>
<span id="cb8-11"><a href="#cb8-11"></a>  theme_minimal()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, we will make our first scatterplot of the course using the Bachelorâ€™s degree attainment for the <em>y-axis</em> and the Median Household Income for the <em>x-axis</em>. To start, we make a <code>tidycensus</code> call for median household income (same as previous); a call for bachelor degree attainment and its universe population for those that have some educational attainment and are 25 years old or older. We then filter for just those PUMAs that contain the name <em>Manhattan</em>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb9-1"><a href="#cb9-1"></a></span>
<span id="cb9-2"><a href="#cb9-2"></a>#Multi-Variable Example: Education vs Income</span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a># Pull ACS variables for education &amp; income at PUMA level</span>
<span id="cb9-5"><a href="#cb9-5"></a>edu_income_puma &lt;- get_acs(</span>
<span id="cb9-6"><a href="#cb9-6"></a>  geography = "puma",</span>
<span id="cb9-7"><a href="#cb9-7"></a>  variables = c(</span>
<span id="cb9-8"><a href="#cb9-8"></a>    median_income = "B19013_001",   # Median household income</span>
<span id="cb9-9"><a href="#cb9-9"></a>    bachelors     = "B15003_022",   # Count with Bachelor's degree</span>
<span id="cb9-10"><a href="#cb9-10"></a>    total_edu     = "B15003_001"    # Total population 25+ with educational attainment</span>
<span id="cb9-11"><a href="#cb9-11"></a>  ),</span>
<span id="cb9-12"><a href="#cb9-12"></a>  state = "NY",</span>
<span id="cb9-13"><a href="#cb9-13"></a>  year = 2023,</span>
<span id="cb9-14"><a href="#cb9-14"></a>  survey = "acs5"</span>
<span id="cb9-15"><a href="#cb9-15"></a>) %&gt;%</span>
<span id="cb9-16"><a href="#cb9-16"></a>  filter(str_detect(NAME, "Manhattan"))   # Keep only Manhattan PUMAs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With the data returned, we have to shape it into the wide format that is best for <code>ggplot</code> and calculate % of population of 25+ with education attainment that do indeed have a bachelorâ€™s degree. Next we create the scatterplot setting the points and the smoothed conditional mean line to show us the relationship between the two variables:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb10-1"><a href="#cb10-1"></a></span>
<span id="cb10-2"><a href="#cb10-2"></a># Reshape &amp; calculate percentage</span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a>edu_income_wide &lt;- edu_income_puma %&gt;%</span>
<span id="cb10-5"><a href="#cb10-5"></a>  select(GEOID, NAME, variable, estimate) %&gt;%</span>
<span id="cb10-6"><a href="#cb10-6"></a>  pivot_wider(names_from = variable, values_from = estimate) %&gt;%</span>
<span id="cb10-7"><a href="#cb10-7"></a>  mutate(</span>
<span id="cb10-8"><a href="#cb10-8"></a>    bachelors_rate = 100 * bachelors / total_edu</span>
<span id="cb10-9"><a href="#cb10-9"></a>  )</span>
<span id="cb10-10"><a href="#cb10-10"></a></span>
<span id="cb10-11"><a href="#cb10-11"></a># Scatterplot: % with Bachelor's degree vs Median Income</span>
<span id="cb10-12"><a href="#cb10-12"></a></span>
<span id="cb10-13"><a href="#cb10-13"></a>ggplot(edu_income_wide, aes(x = bachelors_rate, y = median_income)) +</span>
<span id="cb10-14"><a href="#cb10-14"></a>  geom_point(alpha = 0.7, size = 3) +</span>
<span id="cb10-15"><a href="#cb10-15"></a>  geom_smooth(method = "lm", color = "magenta", se = FALSE) +</span>
<span id="cb10-16"><a href="#cb10-16"></a>  scale_y_continuous(labels = scales::label_comma()) +</span>
<span id="cb10-17"><a href="#cb10-17"></a>  scale_x_continuous(labels = scales::label_percent(scale = 1)) +</span>
<span id="cb10-18"><a href="#cb10-18"></a>  labs(</span>
<span id="cb10-19"><a href="#cb10-19"></a>    title = "Education vs Income (Manhattan PUMAs, ACS 2023)",</span>
<span id="cb10-20"><a href="#cb10-20"></a>    x = "Adults (25+) with Bachelor's Degree (%)",</span>
<span id="cb10-21"><a href="#cb10-21"></a>    y = "Median Household Income (USD)",</span>
<span id="cb10-22"><a href="#cb10-22"></a>    caption = "Source: U.S. Census Bureau, ACS 2023 5-year estimates"</span>
<span id="cb10-23"><a href="#cb10-23"></a>  ) +</span>
<span id="cb10-24"><a href="#cb10-24"></a>  theme_minimal(base_size = 12) +</span>
<span id="cb10-25"><a href="#cb10-25"></a>  theme(plot.title = element_text(face = "bold", hjust = 0.5))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="script-2-mapping-census-block-groups-in-manhattan-cd03" class="level2">
<h2 class="anchored" data-anchor-id="script-2-mapping-census-block-groups-in-manhattan-cd03">Script 2: Mapping Census Block Groups in Manhattan CD03</h2>
<section id="step-1-1" class="level4">
<h4 class="anchored" data-anchor-id="step-1-1">Step 1:</h4>
<p>Make sure <a href="https://github.com/tns-course-repositories/Methods_1-PGUD5160-DUE-Program-fall25/blob/main/scripts/c4_lab4-script-2.R">Class 4 Lab 4 R Script #2</a> is open in your RStudio <code>scripts</code> <em>File&gt;Open File&gt;lab_4&gt;scripts&gt;c4_lab4-script-2.r</em></p>
<p>We can proceed beyond <code>libraries</code> as we have those loaded from the previous script. Here we first suppress scientific notation for plotting and how R potentially handles large numbers:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb11-1"><a href="#cb11-1"></a>options(scipen = 999)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, we are going to use the NYC equivalency file for determining which census tracts fall within NYC Community Districts and NYC Neighborhood Tabulation Areas. For this lab we will be using just one Community District - Manhattan CD 03. This is larger than the NTA â€˜Lower East Sideâ€™ that we have been using:</p>
<blockquote class="blockquote">
<p>Manhattan Community Board 3 encompasses the area of the East Village, Lower East Side, and Chinatown.</p>
</blockquote>
<p>In order to determine both census tracts and census block groups that are within Manhattan CD 03, we will first load the NYC <code>.csv</code> file and then script to pull the needed GEOIDs first into numbers, then convert them to character format and use the result to filter our <code>tidycensus</code> data pull.</p>
<p>Make sure to download the equivalency file, uncompress it and place into the <code>data</code> subdirectory:</p>
<ul>
<li><a href="https://weekly-materials.s3.us-west-1.amazonaws.com/2020_Census_Tracts_to_2020_NTAs_and_CDTAs_Equivalency_20250903.csv.zip">NYC Equivalency File</a></li>
</ul>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The equivalency file, as are all other needed files and scripts for this weekâ€™s assignment and lab, are located also at the bottom of the class 4 agenda.</p>
</div>
</div>
<p>First we read in the <code>.csv</code> and name it as an object <code>CD_CT</code>. We then create a vector were we isolate <code>CDTACode</code> that is equal to <code>MN03</code>, coercing it to the character format. To follow, we build an object named <code>tract_meta</code> that pulls apart the GEOID so that it will work with the <code>tidycensus</code> pull in the next step:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource {{r} number-lines code-with-copy"><code class="sourceCode"><span id="cb12-1"><a href="#cb12-1"></a># --- INPUT: CSV with tract GEOIDs; produce character vector of 11-digit IDs ---</span>
<span id="cb12-2"><a href="#cb12-2"></a>CD_CT &lt;- read.csv("~/Desktop/2020_Census_Tracts_to_2020_NTAs_and_CDTAs_Equivalency_20250903.csv")</span>
<span id="cb12-3"><a href="#cb12-3"></a>tracts_id &lt;- as.character(CD_CT$GEOID[CD_CT$CDTACode == "MN03"])</span>
<span id="cb12-4"><a href="#cb12-4"></a>tracts_id &lt;- stringr::str_pad(tracts_id, 11, pad = "0")</span>
<span id="cb12-5"><a href="#cb12-5"></a></span>
<span id="cb12-6"><a href="#cb12-6"></a># --- Build state/county lookup from tract IDs (works across counties/states) ---</span>
<span id="cb12-7"><a href="#cb12-7"></a>tract_meta &lt;- tibble(GEOID = tracts_id) %&gt;%</span>
<span id="cb12-8"><a href="#cb12-8"></a>  mutate(state = stringr::str_sub(GEOID, 1, 2),</span>
<span id="cb12-9"><a href="#cb12-9"></a>         county = stringr::str_sub(GEOID, 3, 5)) %&gt;%</span>
<span id="cb12-10"><a href="#cb12-10"></a>  distinct(state, county)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, we pass <code>tract_meta</code> along to the <code>tidycensus</code> pull and extract the data for <em>Total Population</em>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb13-1"><a href="#cb13-1"></a># --- Pull ACS 2023 5yr total population for BLOCK GROUPS with geometry (tidycensus only) ---</span>
<span id="cb13-2"><a href="#cb13-2"></a>acs_bg_sf &lt;- purrr::pmap_dfr(tract_meta, function(state, county) {</span>
<span id="cb13-3"><a href="#cb13-3"></a>  get_acs(</span>
<span id="cb13-4"><a href="#cb13-4"></a>    geography   = "block group",</span>
<span id="cb13-5"><a href="#cb13-5"></a>    variables   = "B01001_001",  # total population (use "DP05_0001E" if you prefer Data Profile)</span>
<span id="cb13-6"><a href="#cb13-6"></a>    survey      = "acs5",</span>
<span id="cb13-7"><a href="#cb13-7"></a>    year        = 2023,</span>
<span id="cb13-8"><a href="#cb13-8"></a>    state       = state,</span>
<span id="cb13-9"><a href="#cb13-9"></a>    county      = county,</span>
<span id="cb13-10"><a href="#cb13-10"></a>    geometry    = TRUE,</span>
<span id="cb13-11"><a href="#cb13-11"></a>    cache_table = TRUE</span>
<span id="cb13-12"><a href="#cb13-12"></a>  )</span>
<span id="cb13-13"><a href="#cb13-13"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Before plotting, we then make sure we are just dealing with just block groups within <em>Manhattan CD03</em>. In the previous <code>tidycensus</code> pull, we do get census block groups, but we get them for all of Manhattan where the state is <code>36</code> and the county is <code>061</code>. Here we isolate the block groups that we need and drop everything else. Finally, we do a CRS transformation (more on this as we begin mapping with R soon in upcoming classes):</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb14-1"><a href="#cb14-1"></a># --- Keep only BGs whose first 11 digits (tract) are in the target set; compute labels &amp; shares ---</span>
<span id="cb14-2"><a href="#cb14-2"></a>bg_plot_sf &lt;- acs_bg_sf %&gt;%</span>
<span id="cb14-3"><a href="#cb14-3"></a>  filter(stringr::str_sub(GEOID, 1, 11) %in% tracts_id) %&gt;%</span>
<span id="cb14-4"><a href="#cb14-4"></a>  distinct(GEOID, .keep_all = TRUE) %&gt;%</span>
<span id="cb14-5"><a href="#cb14-5"></a>  rename(pop_total = estimate) %&gt;%</span>
<span id="cb14-6"><a href="#cb14-6"></a>  mutate(</span>
<span id="cb14-7"><a href="#cb14-7"></a>    pop_total = tidyr::replace_na(pop_total, 0),</span>
<span id="cb14-8"><a href="#cb14-8"></a>    pop_share = pop_total / sum(pop_total, na.rm = TRUE),</span>
<span id="cb14-9"><a href="#cb14-9"></a>    BG_label  = stringr::str_sub(GEOID, -5),</span>
<span id="cb14-10"><a href="#cb14-10"></a>    pct_label = scales::percent(pop_share, accuracy = 0.1)</span>
<span id="cb14-11"><a href="#cb14-11"></a>  ) %&gt;%</span>
<span id="cb14-12"><a href="#cb14-12"></a>  # Project to planar CRS to avoid label warnings on lon/lat</span>
<span id="cb14-13"><a href="#cb14-13"></a>  st_transform(2263)  # EPSG:2263 (NYC-friendly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Before proceeding, inspect the resulting dataframe <code>bg_plot_sf</code>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c4_lab_files/img/4-return-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>Manhattan CD03 Census Block Groups w/ ACS 2023 data for the total population variable + MOEs</em></figcaption><p></p>
</figure>
</div>
<p>The first plot maps out each of the census block group geometries in the Manhattan CD03. This gives us a sense of how large these small area census geometries are relative to the CD as a whole:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb15-1"><a href="#cb15-1"></a># --- Map 1: label each CBG with last 5 digits of GEOID ---</span>
<span id="cb15-2"><a href="#cb15-2"></a>ggplot(bg_plot_sf) +</span>
<span id="cb15-3"><a href="#cb15-3"></a>  geom_sf(size = 0.2, fill = "white", color = "black") +</span>
<span id="cb15-4"><a href="#cb15-4"></a>  geom_sf_text(aes(label = BG_label), size = 2.5, color = "darkred", check_overlap = TRUE) +</span>
<span id="cb15-5"><a href="#cb15-5"></a>  coord_sf(expand = FALSE) +</span>
<span id="cb15-6"><a href="#cb15-6"></a>  labs(</span>
<span id="cb15-7"><a href="#cb15-7"></a>    title = "Census Block Groups for Manhattan CD03 Tracts",</span>
<span id="cb15-8"><a href="#cb15-8"></a>    subtitle = "Labels are last 5 digits of GEOID",</span>
<span id="cb15-9"><a href="#cb15-9"></a>    caption = "Source: US Census Bureau ACS 2023 Boundaries"</span>
<span id="cb15-10"><a href="#cb15-10"></a>  ) +</span>
<span id="cb15-11"><a href="#cb15-11"></a>  theme_void(base_size = 11)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, we revise the plot so that the percentage of the total population of CD03 is proportioned to each census block group. This gives us a sense of how many people relative to the whole are contained in each study area census block group. Pay particular attention to the block groups that have zero % of the total population. These geometries often occur over a large portion of water bodies, and they hold little to no population. These can be a problem in our analyses when mapping at these small area geographies. Weâ€™ll be aware of this issue going forward in our mapping work in upcoming classes.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb16-1"><a href="#cb16-1"></a># --- Map 2: label each CBG with % of total population (within selection) ---</span>
<span id="cb16-2"><a href="#cb16-2"></a>ggplot(bg_plot_sf) +</span>
<span id="cb16-3"><a href="#cb16-3"></a>  geom_sf(size = 0.2, fill = "white", color = "black") +</span>
<span id="cb16-4"><a href="#cb16-4"></a>  geom_sf_text(aes(label = pct_label), size = 2.5, color = "darkred", check_overlap = TRUE) +</span>
<span id="cb16-5"><a href="#cb16-5"></a>  coord_sf(expand = FALSE) +</span>
<span id="cb16-6"><a href="#cb16-6"></a>  labs(</span>
<span id="cb16-7"><a href="#cb16-7"></a>    title = "Census Block Groups for Manhattan CD03 Tracts",</span>
<span id="cb16-8"><a href="#cb16-8"></a>    subtitle = "% of total population across selected BGs (ACS 2023 5-year)",</span>
<span id="cb16-9"><a href="#cb16-9"></a>    caption = "Source: US Census Bureau; tidycensus"</span>
<span id="cb16-10"><a href="#cb16-10"></a>  ) +</span>
<span id="cb16-11"><a href="#cb16-11"></a>  theme_void(base_size = 11)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="script-3-4-working-with-acs-data-across-time-time-series-analysis-comparison-chart-for-poverty-rates" class="level2">
<h2 class="anchored" data-anchor-id="script-3-4-working-with-acs-data-across-time-time-series-analysis-comparison-chart-for-poverty-rates">Script 3 &amp; 4: Working with ACS Data Across Time (Time Series Analysis) + Comparison Chart for Poverty Rates</h2>
<section id="step-1-2" class="level4">
<h4 class="anchored" data-anchor-id="step-1-2">Step 1:</h4>
<p>To start, make sure both script #3 and script #4 are downloaded and placed into the <code>scripts/</code> subdirectory:</p>
<p>Make sure <a href="https://github.com/tns-course-repositories/Methods_1-PGUD5160-DUE-Program-fall25/blob/main/scripts/c4_lab4-script-3.R">Class 4 Lab 4 R Script #3</a> is open in your RStudio <code>scripts</code> <em>File&gt;Open File&gt;lab_4&gt;scripts&gt;c4_lab4-script-3.r</em></p>
<p>Follow with <a href="https://github.com/tns-course-repositories/Methods_1-PGUD5160-DUE-Program-fall25/blob/main/scripts/c4_lab4-script-4.R">Class 4 Lab 4 R Script #4</a>; open in your RStudio <code>scripts</code> <em>File&gt;Open File&gt;lab_4&gt;scripts&gt;c4_lab4-script-4.r</em></p>
</section>
<section id="step-2-1" class="level4">
<h4 class="anchored" data-anchor-id="step-2-1">Step 2:</h4>
<p>Load <em>Script #3</em>. Weâ€™ll notice at the top of the script we once again create the <code>CD_CT</code> object specifying <code>MN03</code>. However, this time we also need to load in a crosswalk table from NHGIS which produces many products related to the harmonization of previous census data and its geometries to current geometries. We need to do this harmonization because our time series is going to date back to 2015, and anything before the 2020 census is going to be mapped to the 2010 census geometries. So we need to â€˜harmonizeâ€™ the changes, and that is where the crosswalk table comes into practice.</p>
<blockquote class="blockquote">
<p>NHGIS crosswalk tables allow users to compare and combine U.S. Census Bureau summary data from different geographic units and time periods by providing interpolation weights that allocate data from source zones (e.g., older blocks) to target zones (e.g., newer tracts).</p>
</blockquote>
<p>Make sure to place the crosswalk table (fully uncompressed) into your <code>/data</code> subdirectory; its is from here that we call the table into R as a separate object:</p>
<p>-<a href="https://weekly-materials.s3.us-west-1.amazonaws.com/nhgis_tr2010_tr2020_36.csv.zip">Download Location for NHGIS crosswalk table</a></p>
<p>After calling both the equivalency file and the crosswalk table, we have a helper function makes sure we are using the correct columns and naming from the crosswalk table. We then proceed to organizing the table so that its going to work with the <code>tidycensus</code> data that we are going to download. For each 2010 tract, thereâ€™s a match with the 2020 tract. The column <code>pop_wt</code> is either going to be <code>1</code> for a â€˜one-to-one matchâ€™ or its going to a smaller value which factors the 2010 tracts by a population weight (not for square area land) to be a proportional match with the 2020 tracts. Keep in mind this table is for census tracts, not census block groups. We are mapping here to census tracts alone.</p>
<p>Before proceeding, the script then develops an approach to the MOE - Margin of Error columns in the ACS data. Once done, it makes a determination if the incoming data is from before the 2020 census or after the 2020 census. If it is before, then the crosswalk table has to be applied; if its after, the data is left alone without any reapportionment.</p>
</section>
<section id="step-3-1" class="level4">
<h4 class="anchored" data-anchor-id="step-3-1">Step 3:</h4>
<p>Finally, we get to the critical data pull.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb17-1"><a href="#cb17-1"></a># --- Run for 2015â€“2023 &amp; inspect ---</span>
<span id="cb17-2"><a href="#cb17-2"></a>years &lt;- 2015:2023</span>
<span id="cb17-3"><a href="#cb17-3"></a>ts_poverty_xwalk &lt;- purrr::map_dfr(years, fetch_year) |&gt;</span>
<span id="cb17-4"><a href="#cb17-4"></a>  arrange(year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The resulting object <code>ts_poverty_xwalk</code> is just those particular census tracts - aggregated to just one value - across years 2015 to 2023.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="c4_lab_files/img/4-return-2.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption"><em>Time Series Result</em></figcaption><p></p>
</figure>
</div>
</section>
<section id="step-4" class="level4">
<h4 class="anchored" data-anchor-id="step-4">Step 4:</h4>
<p>Finally, we plot the results as a Time Series, tracking the poverty rate across time in Manhattan CD 03:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb18-1"><a href="#cb18-1"></a># --- Time Series Plot ---</span>
<span id="cb18-2"><a href="#cb18-2"></a>ggplot(ts_poverty_xwalk, aes(x = year, y = pov_rate)) +</span>
<span id="cb18-3"><a href="#cb18-3"></a>  geom_ribbon(</span>
<span id="cb18-4"><a href="#cb18-4"></a>    aes(ymin = pmax(0, pov_rate - pov_rate_moe),</span>
<span id="cb18-5"><a href="#cb18-5"></a>        ymax = pmin(1, pov_rate + pov_rate_moe)),</span>
<span id="cb18-6"><a href="#cb18-6"></a>    alpha = 0.2</span>
<span id="cb18-7"><a href="#cb18-7"></a>  ) +</span>
<span id="cb18-8"><a href="#cb18-8"></a>  geom_line() +</span>
<span id="cb18-9"><a href="#cb18-9"></a>  geom_point(size = 2) +</span>
<span id="cb18-10"><a href="#cb18-10"></a>  scale_x_continuous(breaks = years) +</span>
<span id="cb18-11"><a href="#cb18-11"></a>  scale_y_continuous(labels = scales::percent_format(accuracy = 0.1), limits = c(0, 1)) +</span>
<span id="cb18-12"><a href="#cb18-12"></a>  labs(</span>
<span id="cb18-13"><a href="#cb18-13"></a>    title = "Poverty Rate (ACS 5-year) for MN03 (Aligned to 2020 Tracts via NHGIS Crosswalk)",</span>
<span id="cb18-14"><a href="#cb18-14"></a>    subtitle = "Numerator=B17001_002; Denominator=B17001_001 â€¢ Ribbon=90% MOE\n2015â€“2019 reallocated from 2010 tracts; 2020â€“2023 native 2020 tracts",</span>
<span id="cb18-15"><a href="#cb18-15"></a>    x = "ACS 5-year (end year)",</span>
<span id="cb18-16"><a href="#cb18-16"></a>    y = "Poverty rate",</span>
<span id="cb18-17"><a href="#cb18-17"></a>    caption = "Source: U.S. Census Bureau (ACS 5-year, tidycensus); NHGIS 2010â†’2020 tract crosswalk"</span>
<span id="cb18-18"><a href="#cb18-18"></a>  ) +</span>
<span id="cb18-19"><a href="#cb18-19"></a>  theme_minimal(base_size = 12)</span>
<span id="cb18-20"><a href="#cb18-20"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-5-poverty-rate-comparison-chart" class="level4">
<h4 class="anchored" data-anchor-id="step-5-poverty-rate-comparison-chart">Step 5 (Poverty Rate Comparison Chart:</h4>
<p>With <a href="https://github.com/tns-course-repositories/Methods_1-PGUD5160-DUE-Program-fall25/blob/main/scripts/c4_lab4-script-4.R">Class 4 Lab 4 R Script #4</a> loaded, we will turn to an approach that presents different levels of aggregation for the same variable at one â€˜moment in timeâ€™. In combination with a time series plot, this approach allows for comprehensive understanding not only temporally, but geographically across scales.</p>
<p>To start, make sure sure the <code>gt</code> library is installed and loaded in addtion to <code>tidyverse</code> and <code>tidycensus</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb19-1"><a href="#cb19-1"></a>install.packages("gt")</span>
<span id="cb19-2"><a href="#cb19-2"></a>library(gt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, we will be plotting to the PUMA for CD03 as we did in the earlier EDA analysis. For your assignment, you may want to choose a different PUMA in which case you need to choose the correct GEOID identifier. You can do this via the following linked PDF:</p>
<ul>
<li><a href="https://www2.census.gov/geo/maps/DC2020/PUMA/st36_ny/Catalog_PUMAmaps_st36.pdf">PUMA codes for the NY State</a></li>
</ul>
<p>Next, we make a few basic settings that then feed into the <code>tidycensus</code> pull which returns the object dataframe <code>puma_df</code>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb20-1"><a href="#cb20-1"></a></span>
<span id="cb20-2"><a href="#cb20-2"></a># ---- PUMA: NY PUMAs then filter to 3604103 (suffix 04103) ----</span>
<span id="cb20-3"><a href="#cb20-3"></a>puma_df &lt;- get_acs(</span>
<span id="cb20-4"><a href="#cb20-4"></a>  geography   = "public use microdata area",</span>
<span id="cb20-5"><a href="#cb20-5"></a>  variables   = var_povpct,</span>
<span id="cb20-6"><a href="#cb20-6"></a>  survey      = "acs5",</span>
<span id="cb20-7"><a href="#cb20-7"></a>  year        = acs_year,</span>
<span id="cb20-8"><a href="#cb20-8"></a>  state       = "NY",</span>
<span id="cb20-9"><a href="#cb20-9"></a>  output      = "wide",</span>
<span id="cb20-10"><a href="#cb20-10"></a>  geometry    = FALSE,</span>
<span id="cb20-11"><a href="#cb20-11"></a>  cache_table = TRUE</span>
<span id="cb20-12"><a href="#cb20-12"></a>) %&gt;%</span>
<span id="cb20-13"><a href="#cb20-13"></a>  filter(GEOID == puma_geoid7 | GEOID == puma_code5 | stringr::str_sub(GEOID, -5, -1) == puma_code5) %&gt;%</span>
<span id="cb20-14"><a href="#cb20-14"></a>  transmute(</span>
<span id="cb20-15"><a href="#cb20-15"></a>    geography = "PUMA 3604103 (Manhattan)",</span>
<span id="cb20-16"><a href="#cb20-16"></a>    estimate  = S1701_C03_001E,   # percent</span>
<span id="cb20-17"><a href="#cb20-17"></a>    moe       = S1701_C03_001M    # percentage points (90% MOE)</span>
<span id="cb20-18"><a href="#cb20-18"></a>  )</span>
<span id="cb20-19"><a href="#cb20-19"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This runs through 3 more aggregations - Manhattan, State of NY then the Nation itself. Once complete, the comparison table is made - <code>compare_tbl</code>. Finally the <code>gt</code> library build a nicely formatted table and presents this <code>poverty_table</code> so that we can easily compare the PUMA Poverty Rate with MOE to all the other geographic aggregations in the chart.</p>
</section>
</section>
<section id="extra---time-permitting-script-5-6-working-with-acs-data-across-time-time-series-analysis-comparison-chart-for-rent-burden" class="level2">
<h2 class="anchored" data-anchor-id="extra---time-permitting-script-5-6-working-with-acs-data-across-time-time-series-analysis-comparison-chart-for-rent-burden">(Extra - Time Permitting) Script 5 &amp; 6: Working with ACS Data Across Time (Time Series Analysis) + Comparison Chart for Rent Burden</h2>
<p>To start, make sure both script #5 and script #6 are downloaded and placed into the <code>scripts/</code> subdirectory:</p>
<p>Make sure <a href="https://github.com/tns-course-repositories/Methods_1-PGUD5160-DUE-Program-fall25/blob/main/scripts/c4_lab4-script-5.R">Class 4 Lab 4 R Script #5</a> is open in your RStudio <code>scripts</code> <em>File&gt;Open File&gt;lab_4&gt;scripts&gt;c4_lab4-script-5.r</em></p>
<p>Follow with <a href="https://github.com/tns-course-repositories/Methods_1-PGUD5160-DUE-Program-fall25/blob/main/scripts/c4_lab4-script-6.R">Class 4 Lab 4 R Script #6</a>; open in your RStudio <code>scripts</code> <em>File&gt;Open File&gt;lab_4&gt;scripts&gt;c4_lab4-script-6.r</em></p>
<p>These scripts mimic the form of script #3 and script #4. The difference comes into play with the way in which Rent Burden is calculated as opposed to that of Poverty Rate. In the case of the Poverty Rate calculation, its a simple formula where the numerator is the number of persons that are in the poverty bracket, and the denominator is the total persons for whom poverty was accessed. Rent Burden, on the other hand, contains various levels of burden. In order to utilize a common threshold of <code>&gt;=30% of income</code>, we need to combine several of the Rent Burden brackets. The script calls these variables, then sums them and does the MOE calculations resulting in just one value per geography, per year that is plotting in the same fashion as the time series for the Poverty Rate.</p>
<p>In the case of the comparison table, the same difference applies: the Rent Burden tabulation is made then provided for the various geographic aggregations that are shown in the final comparison table.</p>
</section>
<section id="saving-data-for-assignment-4" class="level2">
<h2 class="anchored" data-anchor-id="saving-data-for-assignment-4">Saving Data for Assignment 4:</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb21-1"><a href="#cb21-1"></a>save(race, file = "results/race.RData")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource {{r}} number-lines code-with-copy"><code class="sourceCode"><span id="cb22-1"><a href="#cb22-1"></a>load("results/race.RData")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="concluding-remarks" class="level2">
<h2 class="anchored" data-anchor-id="concluding-remarks">Concluding Remarks</h2>
<p>In this fourth demonstration lab, we saw some of the various plot and chart options that are available to us via <code>ggplot</code>. While lookup and crosswalk tables significantly complicate both the logic and code approach to our final goal to plot across time, this is the better, more accurate approach than one that does not factor in the changes from early years to the current years. In this weekâ€™s <a href="https://tns-course-repositories.github.io/Methods_1-PGUD5160-DUE-Program-fall25/assignments-labs/c4_assignment">fourth assignment</a>, many of the steps weâ€™ve covered here will be explored further for a specific purpose for a community district in NYC. For those in <a href="https://courses.newschool.edu/courses/PGUD5180">Studio 1</a>, the purpose of the assignment is to get familiar with both the time series and comparison chart approach as this can indeed be one of the upcoming deliverables for <a href="https://courses.newschool.edu/courses/PGUD5180">Studio 1</a> assignment #2.</p>
<p>Access this lab as needed for review and preparation for <a href="https://tns-course-repositories.github.io/Methods_1-PGUD5160-DUE-Program-fall25/assignments-labs/c4_assignment">assignment 4</a>.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References:</h2>
<ul>
<li><a href="https://www.nhgis.org/geographic-crosswalks">NHGIS Crosswalk tables</a></li>
<li><a href="https://catalog.data.gov/dataset/2020-census-tracts-to-2020-ntas-and-cdtas-equivalency">NYC Equivalency Table</a></li>
<li><a href="https://gt.rstudio.com/">gt library charts</a></li>
<li><a href="https://walker-data.com/tidycensus/">tidycensus usage</a></li>
<li><a href="https://rstudio.github.io/cheatsheets/html/data-visualization.html">ggplot2 cheatsheet</a></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp(/^(?:http:|https:)\/\/www\.quarto\.org\/custom/);
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



<script src="c4_lab_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>